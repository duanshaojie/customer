<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Basic -->
    <meta charset="UTF-8" />

    <title>我的订单</title>
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Favicon and touch icons -->
    <link rel="shortcut icon" href="../assets/ico/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../assets/ico/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="../assets/ico/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="../assets/ico/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/ico/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="../assets/ico/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="../assets/ico/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="../assets/ico/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="../assets/ico/apple-touch-icon-152x152.png" />

    <!-- Vendor CSS-->
    <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/vendor/skycons/css/skycons.css" rel="stylesheet" />
    <link href="../assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../assets/vendor/css/pace.preloader.css" rel="stylesheet" />

    <!-- Plugins CSS-->
    <link href="../assets/plugins/bootkit/css/bootkit.css" rel="stylesheet" />
    <link href="../assets/plugins/select2/select2.css" rel="stylesheet" />
    <link href="../assets/plugins/jquery-datatables-bs3/css/datatables.css" rel="stylesheet" />

    <!-- Theme CSS -->
    <link href="../assets/css/jquery.mmenu.css" rel="stylesheet" />

    <!-- Page CSS -->
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/add-ons.min.css" rel="stylesheet" />

    <!-- end: CSS file-->

    <!-- Head Libs -->
    <script src="../assets/plugins/modernizr/js/modernizr.js"></script>
</head>

<body>

<!-- Start: Header -->
<div class="navbar" role="navigation">
    <div class="container-fluid container-nav">
        <!-- Navbar Action -->
        <ul class="nav navbar-nav navbar-actions navbar-left">
            <li class="visible-md visible-lg"><a href="#" id="main-menu-toggle"><i class="fa fa-th-large"></i></a></li>
            <li class="visible-xs visible-sm"><a href="#" id="sidebar-menu"><i class="fa fa-navicon"></i></a></li>
        </ul>
        <!-- Navbar Left -->
        <div class="navbar-left">
            <!-- Search Form -->
            <form class="search navbar-form">
                <div class="input-group input-search">
                    <input type="text" class="form-control bk-radius" name="q" id="q" placeholder="Search...">
                    <span class="input-group-btn">
								<button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>
							</span>
                </div>
            </form>
        </div>
        <!-- Navbar Right -->
        <div class="navbar-right">
            <!-- Userbox -->
            <div class="userbox">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    <figure class="profile-picture hidden-xs">
                        <img src="assets/img/avatar.jpg" class="img-circle" alt="" />
                    </figure>
                    <div class="profile-info">
                        <span class="name" id="username"></span>
                        <span class="role" id="power"><i class="fa fa-circle bk-fg-success"></i></span>
                    </div>
                    <i class="fa custom-caret"></i>
                </a>
                <div class="dropdown-menu">
                    <ul class="list-unstyled">
                        <li class="dropdown-menu-header bk-bg-white bk-margin-top-15">
                            <div class="progress progress-xs  progress-striped active">
                                <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                                    60%
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-user"></i>个人信息</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-wrench"></i>设置</a>
                        </li>
                        <li>
                            <a href="#" onclick="loginOut()"><i class="fa fa-power-off"></i>退出</a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- End Userbox -->
        </div>
        <!-- End Navbar Right -->
    </div>
</div>
<!-- End: Header -->
<!-- Start: Content -->
<div class="container-fluid content">
    <div class="row">

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-collapse">
                <!-- Sidebar Header Logo-->
                <div class="sidebar-header">
                    <img src="../assets/img/school-logo.jpg" class="img-responsive" alt="" />
                </div>
                <!-- Sidebar Menu-->
                <div class="sidebar-menu">
                    <nav id="menu" class="nav-main" role="navigation">
                        <ul class="nav nav-sidebar">
                            <li class="active">
                                <a href="#">
                                    <i class="fa fa-laptop" aria-hidden="true"></i><span>客户管理系统</span>
                                </a>
                            </li>
                            <li>
                                <a href="browse.html">
                                    <i class="fa fa-shopping-cart" aria-hidden="true"></i><span>商品浏览</span>
                                </a>
                            </li>
                            <li>
                                <a href="operation.html">
                                    <i class="fa fa-briefcase" aria-hidden="true"></i><span>商品管理</span>
                                </a>
                            </li>
                            <li  class="nav-parent">
                                <a href="#">
                                    <i class="fa fa-flag" aria-hidden="true"></i><span>订单管理</span>
                                </a>
                                <ul class="nav nav-children">
                                    <li><a href="myorder.html"><span class="text">我的订单</span></a></li>
                                    <li><a href="order.html"><span class="text">收到的订单</span></a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="business.html">
                                    <i class="fa fa-users" aria-hidden="true"></i><span>用户管理</span>
                                </a>
                            </li>
                            <li>
                                <a href="information.html">
                                    <i class="fa fa-gears" aria-hidden="true"></i><span>信息管理</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!-- End Sidebar Menu-->
            </div>
            <!-- Sidebar Footer-->
            <div class="sidebar-footer">
                <ul class="sidebar-terms bk-margin-top-10">
                    <li><a href="http://www.kmu.edu.cn/">关于我们</a></li>
                </ul>
            </div>
            <!-- End Sidebar Footer-->
        </div>
        <!-- End Sidebar -->

        <!-- Main Page -->
        <div class="main ">
            <!-- Page Header -->
            <div class="page-header">
                <div class="pull-left">
                    <ol class="breadcrumb visible-sm visible-md visible-lg">
                        <li><a href="index.html"><i class="icon fa fa-home"></i>主页</a></li>
                        <li class="active"><i class="fa fa-laptop"></i>我的订单</li>
                    </ol>
                </div>
                <div class="pull-right">
                    <h2>我的订单</h2>
                </div>
            </div>
            <!-- End Page Header -->

            <!-- End Main Begin -->
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-default bk-bg-white">
                        <div class="panel-heading bk-bg-white">
                            <h6><i class="fa fa-table red"></i><span class="break"></span>我的订单</h6>
                        </div>
                        <div class="panel-body">
                            <table class="table table-bordered table-striped" id="datatable-default">
                                <thead>
                                <tr>
                                    <th>商品名称</th>
                                    <th>商品编号</th>
                                    <th>实际支付</th>
                                    <th>保单号</th>
                                    <th>消费者</th>
                                    <th>商家</th>
                                    <th>状态</th>
                                    <th>下单时间</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Main Page -->
        </div>
        </div>
    </div><!--/container-->


    <div class="clearfix"></div>



<!-- Vendor JS-->
<script src="../assets/vendor/js/jquery.min.js"></script>
<script src="../assets/vendor/js/jquery-2.1.1.min.js"></script>
<script src="../assets/vendor/js/jquery-migrate-1.2.1.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../assets/vendor/skycons/js/skycons.js"></script>
<script src="../assets/vendor/js/pace.min.js"></script>

<!-- Plugins JS-->
<script src="../assets/plugins/moment/js/moment.min.js"></script>
<script src="../assets/plugins/select2/select2.js"></script>
<script src="../assets/plugins/jquery-datatables/media/js/jquery.dataTables.js"></script>
<script src="../assets/plugins/jquery-datatables/extras/TableTools/js/dataTables.tableTools.min.js"></script>
<script src="../assets/plugins/jquery-datatables-bs3/js/datatables.js"></script>
<script src="../assets/plugins/sparkline/js/jquery.sparkline.min.js"></script>

<!-- Theme JS -->
<script src="../assets/js/jquery.mmenu.min.js"></script>
<script src="../assets/js/core.min.js"></script>
<script src="../assets/layer/layer.js"></script>
<script src="../assets/main.js"></script>
<!-- Pages JS -->
<script src="../assets/js/pages/table-advanced.js"></script>

<!-- end: JavaScript-->

</body>
<script type="text/javascript">
    //登录之后
    $(function() {
        $.ajax({
            "async": true,
            "crossDomain": true,
            "url": url+"user/query",
            "method": "GET",
            "headers": {
                "content-type": "application/json",
                "cache-control": "no-cache",
                "postman-token": "f7b21967-8095-8bea-5f60-ed8da73aaa16"
            },
            "processData": false,
            success:function(dataa){
                console.log(dataa);
                $('#username').text(dataa['userName']);
                var power = dataa['power'];
                if(power==30){
                    //超级管理员
                    $('#power').text("超级管理员");
                }else if(power==20){
                    //商户
                    $('#power').text("商户");
                }else{
                    $('#power').text("个人用户");
                }


                var dataTableConfig = {
                    "destroy" : true,
                    "serverSide" : false,//分页，取数据等等的都放到服务端去
                    "processing" : false,//载入数据的时候是否显示“载入中”
                    "ordering" : false,//排序操作在服务端进行，所以可以关了。
                    "info" : false,
                    "sPaginationType": "full_numbers",//设置分页控件的模式
                    "bLengthChange" : false,//屏蔽tables的一页展示多少条记录的下拉列表
                    "iDisplayLength" : 10,
                    "searching" : false,
                    "bPaginate": true,
                    "ajax" : {
                        type : "GET",
                        url: url+"order/myOrder",
                        dataType : "JSON",
                        error:handleAjaxError
                    },
                    "columns" : [
                        {data:'goodsName'},
                        {data:'goodsCode'},
                        {data:'price'},
                        {data:'quotationNumber'},
                        {data:'consumer'},
                        {data:'business'},
                        {data:'status',
                            "render":function(data, type, full) {
                                if(data==10){
                                    result = 10;
                                    return "<span style='color: red'>商家正在发货</span>"
                                }
                                else{
                                    result = 20;
                                    return "<span style='color: green'>商家已发货</span>"
                                }
                            }
                        },
                        {data:'createTime',
                        	"render":function(date, type, full){
                                var unixTimestamp = new Date(date) ;
                                return unixTimestamp.toLocaleString();
                            }},
                        {data:'quotationNumber',
                            "render":function(data, type, full) {
                                if(result==20){
                                    return '<a href="javascript:void(0)" onclick="commentOrder(\''+data+'\')">评论</a>|'+
                                        '<a href="javascript:void(0)" onclick="deleteOrder(\''+data+'\')">删除</a>';

                                }else{
                                    return '<a href="javascript:void(0)" onclick="deleteOrder(\''+data+'\')">删除</a>';
                                }
                            }}
                    ],
                    "language" : {
                        "sProcessing" : "正在加载中......",
                        "sLengthMenu" : "每页显示 _MENU_ 条记录",
                        "sZeroRecords" : "无",
                        "sEmptyTable" : "表中无数据存在！",
                        "oPaginate" : {
                            "sFirst" : "首页",
                            "sPrevious" : "上一页",
                            "sNext" : "下一页",
                            "sLast" : "末页"
                        }
                    }
                };
                var dataTable = $('#datatable-default').DataTable(dataTableConfig);
            },
            error:function(data){
                location.href = "login.html";
            }
        })
    });
    function deleteOrder(quotationNumber){
        $.ajax({
            type:"GET",
            async: true,
            url:url+"order/delete/"+quotationNumber,
            contentType: "application/json; charset=utf-8",
            dataType:"text",
            success:function (date) {
                console.log(date);
                console.log("OK");
                alert("删除成功");
                location.href = "myorder.html?ranparam="+Math.ceil(Math.random()*10000000000);
            },error:function(date){
                console.log("ERROR");
                console.log(date);
            }
        });
    }



    function commentOrder(quotationNumber){
        var index =  layer.open({
            type: 2,
            title: '评论',
            shadeClose: true,
            shade: false,
            maxmin: true, //开启最大化最小化按钮
            area: ['300px','400px'],
            content: 'addComment.html?quotationNumber='+quotationNumber
        });
        layer.iframeAuto(index);
        return false;
    }

    //退出登录
</script>
</html>